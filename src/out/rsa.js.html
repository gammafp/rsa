<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: rsa.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: rsa.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var keys = require('./rsaKeys.json');
var BigInt = require('node-jsbn');

/**
 * @author Francisco José Pereira Alvarado &lt;gammafp@gmail.com>
 * @version 26.1.17
 */

/**
 * Clase encriptación RSA
 */

class RSA {
    /**
     * Asignamos las claves publica y la privada
     * @param {string} N - Modulus, es parte de la clave publica, el modulus se tiene que pasar con un numero Hexadecimal en String.
     * @param {string} E - Exponente, es parte de la clave publica el exponente se tiene que pasar como un numero decimal en String.
     * @param {string} D - Es la llave privada, se usa para firmar, la llave privada se tiene que pasar como un Hexadecimal en String.
     */
    constructor(N, E, D) {
        this.N = (typeof(N) == 'String') ? new BigInt(N, 16) : new BigInt(N.toString(), 16);
        this.E = (typeof(E) == 'String') ? new BigInt(E, 10) : new BigInt(E.toString(), 10);
        this.D = (typeof(D) == 'String') ? new BigInt(D, 16) : new BigInt(D.toString(), 16);
        
        this.blockSize = Math.floor((this.N.bitLength() + 7) / 8);
    }
    /**
     * Metodo de firma RSA
     * @param {string} Recibe un numero (tambien puede ser un texto) que se tiene que pasar como cadena de texto.
     * @return {string} Devolverá la el numero firmado y encriptado con RSA (en hexadecimal). 
     */
    Sign(src) {
        /** Se comprueba que sea un string, y si no lo es este se convierte a string */
        var srcString = (typeof(src) != 'string') ? src.toString() : src;
        
        /** Convertimos el string a unicode para poder agregarle el padding y poder encriptar */
        var mensaje = [].map.call(srcString, (x) => {
            return x.charCodeAt(0);
        });

        /** Se agrega el padding */
        var padding = this.PADDING(mensaje);
        /** El array resultando se convierte a numeros para poder usar la formula de RSA m^d MOD n */
        var biPad = new BigInt(padding);
        /** Se hace la formula RSA luego se convierte a un string hexadecimal. */
        return this.keyPrivate(biPad).toString(16).toUpperCase();
        
    }
    /**
     * Formula para encriptar con la clave privada.
     * @return {BigInt} Devuelve el resultado de aplicar la formula.
     */
    keyPrivate(m) {
        return m.modPow(this.D, this.N);
    }
    /**
     * Formula para verificar la firma.
     * @return {BigInt} Devuelve el resultado de alicar la formula.
     */
    keyPublic(m) {
        return m.modPow(this.E, this.N);
    }

    /**
     * Metodo que nos sirve para agregar el relleno
     * @return {array} Devuelve un array con los padding agregados 
     * cuyo orden es mas o menos parecido a esto: [0, 1, 255, 255, 255, 0, 97, 43]
     * donde los ceros indican separacion y el 1 del indice 1 indica el tipo de 
     * array, en este caso el 1 es FULLBYTE.
     * los numeros finales del array despues del segundo cero, es el mensaje codificado en unicode para cada caracter.
     */
    PADDING(src) {
        /** El tamaño del array restandole el tamaño del src y restandole un tres que corresponden
        al tamaño de los separadores y el tipo de padding a aplicar */
        var arraySize = this.blockSize - src.length - 3;
        var padding = new Array(arraySize);
        /** Fill rellena el array que se ha creado */
        padding.fill(0xFF);

        /** Marca de tipo (FULLBYTE = 1, RANDOMBYTE = 2) */
        padding.unshift(1);
        /** Marca de inicio, tiene que ser cero */
        padding.unshift(0);

        /** Marca de separacion entre padding y mensaje */
        padding.push(0, ...src);

        return padding;
    
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="RSA.html">RSA</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Jan 26 2017 22:02:46 GMT+0100 (Hora estándar romance)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
